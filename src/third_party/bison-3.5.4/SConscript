# -*- mode: python -*-
Import('env')

bison_root = env.Dir(".").srcnode()
env = env.Clone(
    # tools=['lex'], 
    # LEX="flex", #LEX="/home/nz_linux/mongo_antlr/src/third_party/bison-3.5.4/build-aux/ylwrap",
)
env.Append(CPPPATH=[bison_root.Dir("lib"), bison_root.Dir("src")])
env.AppendUnique(CCFLAGS=['-Wno-sign-compare', '-Wno-int-conversion', '-DGCC_LINT']) # GCC_LINT for "use before initialized errors"
# env.AppendUnique(CCFLAGS=['-DDEFAULT_TEXT_DOMAIN="bison-gnulib"'])
# env.CFile(target="src/scan-code.c", source="src/scan-code.l"),
# env.CFile(target="src/scan-gram.c", source="src/scan-gram.l"),
# env.CFile(target="src/scan-skel.c", source="src/scan-skel.l"),
bison = env.Program(
    target='bison-prog',
    source=[
        "lib/allocator.c",
        "lib/areadlink.c",
        "lib/argmatch.c",
        "lib/binary-io.c",
        "lib/bitrotate.c",
        "lib/bitset.c",
        "lib/bitset/array.c",
        "lib/bitset/stats.c",
        "lib/bitset/table.c",
        "lib/bitset/list.c",
        "lib/bitset/vector.c",
        "lib/bitsetv.c",
        "lib/c-ctype.c",
        "lib/c-strcasecmp.c",
        "lib/c-strncasecmp.c",
        "lib/careadlinkat.c",
        "lib/cloexec.c",
        "lib/close-stream.c",
        "lib/closeout.c",
        "lib/concat-filename.c",
        "lib/dirname.c",
        "lib/basename.c",
        "lib/dirname-lgpl.c",
        "lib/basename-lgpl.c",
        "lib/stripslash.c",
        "lib/exitfail.c",
        "lib/fatal-signal.c",
        "lib/fd-safer-flag.c",
        "lib/dup-safer-flag.c",
        "lib/fopen-safer.c",
        "lib/fstrcmp.c",
        "lib/gethrxtime.c",
        "lib/xtime.c",
        "lib/getprogname.c",
        "lib/gettime.c",
        "lib/hard-locale.c",
        "lib/hash.c",
        "lib/gl_list.c",
        "lib/localcharset.c",
        "lib/glthread/lock.c",
        "lib/math.c",
        "lib/mbchar.c",
        "lib/mbfile.c",
        "lib/mbswidth.c",
        "lib/pipe2.c",
        "lib/pipe2-safer.c",
        "lib/printf-frexp.c",
        "lib/printf-frexpl.c",
        "lib/progname.c",
        "lib/quotearg.c",
        "lib/setlocale_null.c",
        "lib/sig-handler.c",
        "lib/spawn-pipe.c",
        "lib/glthread/threadlib.c",
        "lib/timespec.c",
        "lib/timevar.c",
        "lib/glthread/tls.c",
        "lib/unistd.c",
        "lib/dup-safer.c",
        "lib/fd-safer.c",
        "lib/pipe-safer.c",
        "lib/uniwidth/width.c",
        "lib/wait-process.c",
        "lib/wctype-h.c",
        "lib/xmalloc.c",
        "lib/xalloc-die.c",
        "lib/xconcat-filename.c",
        "lib/xhash.c",
        "lib/gl_xlist.c",
        "lib/xmemdup0.c",
        "lib/xreadlink.c",
        "lib/xsize.c",
        "lib/xstrndup.c",
        "lib/get-errno.c",
        "lib/path-join.c",
        "lib/asnprintf.c",
        "lib/asprintf.c",
        "lib/fcntl.c",
        "lib/fprintf.c",
        "lib/fseterr.c",
        "lib/mbrtowc.c",
        "lib/obstack.c",
        "lib/printf.c",
        "lib/printf-args.c",
        "lib/printf-parse.c",
        "lib/snprintf.c",
        "lib/sprintf.c",
        "lib/vasnprintf.c",
        "lib/vasprintf.c",
        "lib/vfprintf.c",
        "lib/vsnprintf.c",
        "lib/vsprintf.c",
        "lib/gl_array_list.c",
        "src/AnnotationList.c",
        "src/assoc.c",
        "src/closure.c",
        "src/complain.c",
        "src/conflicts.c",
        "src/derives.c",
        "src/files.c",
        "src/fixits.c",
        "src/getargs.c",
        "src/gram.c",
        "src/graphviz.c",
        "src/ielr.c",
        "src/InadequacyList.c",
        "src/lalr.c",
        "src/location.c",
        "src/lr0.c",
        "src/main.c",
        "src/muscle-tab.c",
        "src/named-ref.c",
        "src/nullable.c",
        "src/output.c",
        "src/parse-gram.c",
        "src/print.c",
        "src/print-graph.c",
        "src/print-xml.c",
        "src/reader.c",
        "src/reduce.c",
        "src/relation.c",
        "src/Sbitset.c",
        "src/state.c",
        "src/symlist.c",
        "src/symtab.c",
        "src/tables.c",
        "src/uniqstr.c",
        "src/scan-code-c.c",
        "src/scan-gram-c.c",
        "src/scan-skel-c.c",
        # "src/scan-code.c",
        # "src/scan-gram.c",
        # "src/scan-skel.c",
	],
    AIB_COMPONENT="bison-prog", # Allows build target install-bison-prog
)
env.Install("$DESTDIR/bin", "bison")
